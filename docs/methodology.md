# Testing methodology of YouTrack v0.1

## About SUT

- Version: 2024.2.38971

## Goals of testing

- Measure the minimum time is needed to 100k issues to an empty Demo-project.
- Proove that system can serve 100 concurrent users with database of 100k issues.
- Measure the maximum number of concurrent users that the system can serve without it's perfromance degradation

## Non-functional requirements

- 90-percetile of response time for request `GET /api/sortedIssues` lte 500 ms

- 90-percentile of response time for request `GET /api/issue/{id}?fields=...` lte 500 ms

- 90-percentile of response time for request `POST /api/issuesGetter?fields=...` lte 1000 ms

- percent of error responses (HTTP 5**) lte 1%

## Limits

- The testing will executed on the evironment with a minimal amount of hardware resources.
- The load profile is an empiric one.

Because of that all future results should not be extrapolated on a real system.

## Strategy

### Tests

To achieve the goals of testing two sets of tests should be executed.

The first includes:

- Test to find maximum performance (MaxPerf) with a stepped increasing load from 0 rps to point of degradation. It allows to define the maximal speed of the issue creation with which an application performance doesn't degrade.

   Then we can aproximately calculate the minimum time of loading 100k issues.

The second set includes:

- Test to find MaxPerf with a stepped-spahed load. The first step is 20 users, the each next step is 20 users.

   Test contains 10 steps 10 minutes each with 5 minutes ramp-up (from 20 to 200 concurrent users, 10 x 15 minutes = 150 minutes for all test). Test will use a closed load model.

   This test will help to find the amount of users that system can serve before it's performance derades.

   The point of degradation is defined as number of users with which system do not satisfy at least one of NFRs. The maximum performance point is defined as the one step before the point of degradation.

- Test to approve MaxPerf. This is the load test with static load level of 80% from found MaxPerf. A ramp-up duration - 10 minutes, a stable load duration - 60 minutes.

### Profile

A load profile for the first set of test is pretty simple and includes only one operation of adding the issue: `POST /api/issues`.

A load profile for the second set is more complex and should include more user operations.

Each concurrent user wil share the same behaviour :

1. make a search (1 time, all):
   - `POST /search/assist`
   - `POST /sortedIssues`
   - `POST /issuesGetter`

2. open issue (3 times, all)
   - `GET /users/me/recent/issues`
   - `GET /users/me`
   - `GET /issues/${id}`

3. for one of opened issues make one of mutations (1 time, random one):
   - comment: `POST /issues/${id}/comment {text: "..."}`
   - add link: `POST /command {query: "..."}`
   - change desc: `POST /issue/${id} { description: "..." }`

The final profile for 100 users looks like this:

| name | reuqest | rph | rps |
| --- | --- | --- | --- |
| searchAssist | POST /search/assist | 1000 | 0.28 |
| sortedIssues | POST /sortedIssues | 1000 | 0.28 |
| issuesGetter | POST /issuesGetter | 1000 | 0.28 |
| recentIssues | GET /users/me/recent/issues | 3000 | 0.84 |
| me | GET /users/me | 3000 | 0.84 |
| openIssue | GET /issues/${id} | 3000 | 0.84 |
| comment | POST /issues/${id}/comment | 250 | 0.07 |
| addLink | POST /command | 250 | 0.07 |
| changeDesc | POST /issue/${id} | 250 | 0.07 |
| addTag | POST /issue/${id} | 250 | 0.07 |
|| **Total:** | **14000** | **3.89** |

### Testing data

All data for test will be random generated by testing tools.

### Testing environment

- Application will run at an AWS EC2 t2.2xLarge instance (8 CPU, 32 RAM).
- Generator will run at perftester's Macbook Pro M1 (2020) (16 Gb RAM)

### Tools

- Gatling v3.10 (Scala, sbt)  for load generation
- InfluxDB/Grafana (in docker, latest version) for test generator monitoring
- Prometheus (in doker, latest version) with custom exporter (python 3.10) for collecting SUT metrics
